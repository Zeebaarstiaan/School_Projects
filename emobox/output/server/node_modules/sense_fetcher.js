var request   = require('request'),
    sessionId = '8964527b64ab92bbc5.06744125';

function getData (id, callback, parameters) {
    var data = null,
        uri  = 'https://api.sense-os.nl/sensors/' + id + '/data';

    if (typeof parameters !== undefined) {
        uri += '?' + parameters;
    }

    request.get(
        {
            'uri' : uri,
            'headers': {
                'Accept'      : 'application/json',
                'X-SESSION_ID': sessionId
            }
        },
        function (error, response, body) {
            if (!error && response.statusCode == 200) {
                console.log('data found');
                var dataJson = JSON.parse(body);
                callback(dataJson.data);
            } else {
                console.log('error');
            }
        }
    );
}

exports.getHeartBeatData = function (callback) {
    console.log('Get heartbeat data')
    return getData(
        422419,
        callback,
        'per_page=30&sort=DESC'
    );
};

exports.getHeartBeatDataHistory = function (callback) {
    console.log('Get heartbeat data')
    return getData(
        422419,
        callback,
        'per_page=1000&interval=60'
    );
};

exports.getWifiData = function (callback) {
    var now = new Date();
    now.setHours(0, 0, 0, 0);
    console.log('Get wifi data');
    return getData(
        420830,
        callback,
        'per_page=1000&interval=3600&end_date=' + (now.getTime() / 1000)
    );
};

exports.getAccelartionData = function (callback) {
    console.log('Get acceleleration data')
    return getData(
        420839,
        callback,
        'per_page=1000'
    );
};

exports.getNoisedata = function (callback) {
    console.log('Get noise data')
    return getData(
        420822,
        callback,
        'per_page=1000'
    );
};